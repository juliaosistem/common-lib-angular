name: Sync with Jenkins Multibranch

on:
  push:
    branches: ['develop', 'master']  # Todas las ramas
  pull_request:
    branches: ['develop', 'master','despliegues']  # Todos los PRs

jobs:
  notify-jenkins:
    runs-on: ubuntu-latest
    
    steps:
      - name: Notify Jenkins
        run: |
          echo "üîÑ Jenkins Multibranch detectar√° este push autom√°ticamente"
          echo "üì¶ Rama: ${{ github.ref_name }}"
          echo "üìù Commit: ${{ github.sha }}"
          
          # Opcional: notificaci√≥n manual inmediata a Jenkins (Git plugin)
          # Requiere configurar secret JENKINS_URL (ej: https://jenkins.juliaosistem-server.in)
          # y opcionalmente JENKINS_USER/JENKINS_TOKEN si tu Jenkins exige auth.
          echo "üì£ Notificando a Jenkins v√≠a notifyCommit"
          REPO_URL="${{ github.server_url }}/${{ github.repository }}"
          JENKINS_URL="${{ secrets.JENKINS_URL }}"
          if [ -n "$JENKINS_URL" ]; then
            if [ -n "${{ secrets.JENKINS_USER }}" ] && [ -n "${{ secrets.JENKINS_TOKEN }}" ]; then
              curl -sS -f -X POST "$JENKINS_URL/git/notifyCommit?url=$REPO_URL" \
                -u "${{ secrets.JENKINS_USER }}:${{ secrets.JENKINS_TOKEN }}" || echo "‚ö†Ô∏è notifyCommit respondi√≥ error"
            else
              curl -sS -f -X POST "$JENKINS_URL/git/notifyCommit?url=$REPO_URL" || echo "‚ö†Ô∏è notifyCommit respondi√≥ error"
            fi
          else
            echo "‚ÑπÔ∏è JENKINS_URL no definido en secrets; omitiendo notifyCommit"
          fi

          # Ejemplo alternativo (comentado): webhook del plugin GitHub si lo necesitas
          # curl -sS -f -X POST "$JENKINS_URL/github-webhook/" \
          #   -H "Content-Type: application/json" \
          #   -H "X-GitHub-Event: push" \
          #   -d '{"ref":"${{ github.ref }}","repository":{"html_url":"'"$REPO_URL"'"}}' || true

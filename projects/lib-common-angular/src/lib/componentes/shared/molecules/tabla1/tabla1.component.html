<!-- Diálogo de edición -->
<p-dialog
  [(visible)]="itemDialog"
  [modal]="true"
  [style]="{ width: '450px' }"
  header="Item Details"
  styleClass="p-fluid"
>
  <ng-template #content>

    @for (field of displayFields; track field.key) {
      <div class="field">
        <label [for]="field.key">{{ field.label }}</label>
        @switch (field.type) {
          @case ('text') {
            <input pInputText [id]="field.key" [(ngModel)]="currentItem[field.key]" />
          }
          @case ('number') {
            <p-inputNumber [id]="field.key" [(ngModel)]="currentItem[field.key]" mode="decimal" />
          }
          @case ('checkbox') {
            <p-checkbox [id]="field.key" [(ngModel)]="currentItem[field.key]" [binary]="true" />
          }
          @case ('select') {
            <p-select 
              [id]="field.key" 
              [(ngModel)]="currentItem[field.key]" 
              [options]="getSelectOptions(field.key)"
              optionLabel="label"
              optionValue="value"
              placeholder="Select {{field.label}}"
              [showClear]="true"
            />
          }
          @default {
            <input pInputText [id]="field.key" [(ngModel)]="currentItem[field.key]" />
          }
        }
      </div>
    }
  </ng-template>
  <ng-template #footer>
    <p-button label="Cancel" icon="pi pi-times" [text]="true" (click)="hideDialog()" />
    <p-button label="Save" icon="pi pi-check" [text]="true" (click)="saveItem()" />
  </ng-template>
</p-dialog>

<!-- Tabla -->
<p-table
  #dt
  [value]="data"
  [rows]="10"
  [paginator]="true"
  [globalFilterFields]="['name']"
  [tableStyle]="{ 'min-width': '75rem' }"
  [(selection)]="selectedItems"
  [rowHover]="true"
  dataKey="id"
  currentPageReportTemplate="Showing {first} to {last} of {totalRecords} items"
  [showCurrentPageReport]="true"
  [rowsPerPageOptions]="[10, 20, 30]"
>
  <ng-template #caption>
    <div class="flex items-center justify-between">
      <h5 class="m-0">{{tableTitle}}</h5>
      <p-button label="New" icon="pi pi-plus" severity="success" (click)="editItem({})" />
    </div>
  </ng-template>
  
  <ng-template #header>
    <tr>
      <th style="width: 3rem"><p-tableHeaderCheckbox /></th>
      @for (field of displayFields; track field.key) {
        <th style="min-width: 12rem">{{ field.label }}</th>
      }
      <th style="min-width: 12rem">Actions</th>
    </tr>
  </ng-template>
  
  <ng-template #body let-item>
    <tr>
      <td style="width: 3rem"><p-tableCheckbox [value]="item" /></td>
      @for (field of displayFields; track field.key) {
        <td>
          @switch (field.type) {
            @case ('img') {
              <img [src]="getImageUrl(field, item[field.key])" [alt]="getImageAltText(field, item)" style="width: 64px" class="rounded" />
            }
            @case ('checkbox') {
               <span class="flex items-center gap-2">
                  <i [class]="item[field.key] ? 'pi pi-check-circle text-green-500' : 'pi pi-times-circle text-red-500'"></i>
                  <span>{{ item[field.key] ? 'Yes' : 'No' }}</span>
                </span>
            }
            @default {
              <span>{{ formatDynamicFieldValue(field, item[field.key]) }}</span>
            }
          }
        </td>
      }
      <td>
        <p-button icon="pi pi-pencil" class="mr-2" [rounded]="true" [outlined]="true" severity="info" (click)="editItem(item)" />
        <p-button icon="pi pi-trash" severity="danger" [rounded]="true" [outlined]="true" (click)="deleteItem(item)" />
      </td>
    </tr>
  </ng-template>
</p-table>

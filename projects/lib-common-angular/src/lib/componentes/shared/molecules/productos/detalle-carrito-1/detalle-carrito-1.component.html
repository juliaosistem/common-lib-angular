@if (product) {
<div id="product-container" class="shadow-2 border-round-2xl p-3 md:p-5 lg:p-6">
        <!-- Contenedor principal de la página de detalle -->
        <div class="grid">
            <!-- Bloque de imagen principal -->
            <div class="flex flex-column  col-12 lg:col-6">
                <div class="main-image-frame bg-gray-100 border-round-xl flex justify-content-center align-items-center">
                    <img
                        [src]="selectedImageUrl"
                        [alt]="product.imagen[0].alt || product.name"
                        loading="lazy" width="1024" height="520"
                        class="main-image border-round-xl" />
                </div>

                <!-- Miniaturas debajo en móvil y tablet -->
                @if (product.imagen && product.imagen.length > 0) {
                <div class="flex flex-row gap-2 overflow-x-auto pt-2">
                    @for (imagen of product.imagen; track $index) {
                        <button type="button" class="thumbnail-container border-round-lg cursor-pointer" (click)="updateMainImage(imagen.url)">
                            <div class="thumbnail" [class.thumbnail-active]="isActiveThumbnail(imagen.url)">
                                <img [src]="imagen.url" alt="Miniatura {{ imagen.alt }}" loading="lazy" width="88" height="88" />
                            </div>
                        </button>
                    }
                </div>
                }
            </div>

            <!-- Columna de información del producto -->
            <div class="flex flex-column justify-content-between col-12 lg:col-6">
                <div class="flex flex-column gap-3">
                    <div class="flex justify-content-between align-items-center mb-2">
                        <h1 class="text-3xl font-bold text-900">{{ product.name }}</h1>
                        <p-button 
                            [text]="true" 
                            [rounded]="true"
                            (onClick)="toggleFavorite()"
                            [icon]="isFavorite ? 'pi pi-heart-fill' : 'pi pi-heart'"
                            [class]="isFavorite ? 'text-red-500' : 'text-500'"
                            class="hover:text-red-500">
                        </p-button>
                    </div>

    

                    <!-- Bloque descripción con fondo gris como card -->
                    <div class="surface-ground p-3 border-round-xl border-1 surface-border">
                        <p class="text-700 line-height-3 m-0 font-bold">Descripción</p>
                        <p class="text-700 line-height-3 m-0">{{ product.descripcion }}</p>
                    </div>

                    <div class="flex align-items-center gap-3">
                        @if(isLogin){
                            @if(product.descuento != undefined && product.descuento > 0) {
                                <span class="old-price">{{ product.precios[0].precio | currency:product.precios[0].codigo_iso :'code' }}</span>
                                <span class="discount-label">{{ product.descuento}}% OFF</span>
                            }
                            <span class="current-price">{{ discount | currency:product.precios[0].codigo_iso :'code'}}</span>
                        } @else {
                            <a
                                class="contact-btn"
                                [href]="getWhatsAppLink()"
                                target="_blank" rel="noopener noreferrer"
                                aria-label="Contactar por WhatsApp">
                                <i class="pi pi-whatsapp"></i>
                                <span>Contactar</span>
                            </a>
                        }
                    </div>

                    <!-- Info básica: categoría y disponibles -->
                    <div class="surface-ground p-3 border-round-xl border-1 surface-border text-sm">
                        <div class="flex justify-content-between align-items-center mb-2">
                            <strong class="font-bold text-700">Categoría:</strong>
                            <span class="text-600 text-right overflow-hidden text-overflow-ellipsis" style="max-width: 60%;">
                                {{ product.nombreCategoria || 'Sin categoría' }}
                            </span>
                        </div>
                        <div class="flex justify-content-between align-items-center">
                            <strong class="font-bold text-700">Disponibles:</strong>
                            <span class="text-600 font-medium">{{ product.cantidad }}</span>
                        </div>
                    </div>

                    <!-- Badges informativos -->
                    <div class="info-badges mb-4">
                        <div class="badge"><i class="pi pi-shield"></i><span>Compra protegida</span></div>
                        <div class="badge"><i class="pi pi-truck"></i><span>Entrega rápida</span></div>
                    </div>
                </div>

                <div class="cta-card">
                    <!-- Botones de acción: Personalizar y Compartir -->
                    <div class="flex gap-2 mb-3">
                        @if (isPersonalizable) {
                            <p-button 
                                (click)="navigateToProductDetail()" 
                                pTooltip="Personalizar"
                                icon="pi pi-pencil"
                                tooltipPosition="top"
                                styleClass="bg-900 text-white w-2rem h-2rem border-circle border-none flex align-items-center justify-content-center cursor-pointer hover:bg-700 transition-colors shadow-1">
                            </p-button>
                        }
                        <p-button 
                             
                            pTooltip="Compartir"
                            tooltipPosition="top"
                            icon="pi pi-share-alt text-sm"
                            styleClass="surface-100 text-900 w-2rem h-2rem border-circle border-none flex align-items-center justify-content-center cursor-pointer hover:bg-200 transition-colors shadow-1">
                        </p-button>
                    </div>
               

                    <lib-section-add-cards-buttons 
                        [product]="product" 
                        [isLogin]="isLogin">
                    </lib-section-add-cards-buttons>

                    @if (showCartMessage) {
                        <div class="mt-3 text-center text-sm font-semibold text-green-600">
                            Producto añadido al carrito.
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
} @else {
    <div class="surface-card shadow-2 border-round-2xl p-3 md:p-5 lg:p-6 w-full">
        <div class="flex justify-content-center align-items-center" style="height: 16rem;">
            <p class="text-500 text-lg">Cargando producto...</p>
        </div>
    </div>
}
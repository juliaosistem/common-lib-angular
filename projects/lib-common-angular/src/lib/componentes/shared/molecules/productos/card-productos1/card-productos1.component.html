<div class="product-card flex flex-col h-full rounded-xl shadow-lg hover:shadow-2xl transition-shadow duration-300 overflow-hidden bg-white">
    @if (product) {
    <!-- Contenedor de la imagen principal y la galería de miniaturas que se muestra con hover -->
    <div class="main-image-container relative group" 
         (mouseenter)="onMouseEnter()" 
         (mouseleave)="onMouseLeave()">
        
        <!-- Slider de imágenes -->
        <div class="image-slider relative">
            <img [src]="currentImageUrl" 
                 [alt]="product.name" 
                 class="transition-opacity duration-500 active cursor-pointer">
            
            <!-- Overlay con icono de lupa -->
            <div class="image-overlay absolute inset-0 bg-black bg-opacity-40 opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-center justify-center cursor-pointer"
                 (click)="navigateToProductDetail()">
                <div class="magnify-icon bg-white bg-opacity-90 rounded-full p-3 transform scale-90 group-hover:scale-100 transition-transform duration-300 hover:bg-opacity-100">
                    <i class="pi pi-search text-2xl text-gray-700"></i>
                </div>
            </div>
        </div>
        
        <!-- Controles del slider -->
        <div class="slider-controls">
            <p-button 
                icon="pi pi-chevron-left" 
                [text]="true" 
                [rounded]="true"
                (onClick)="prevImage()"
                class="p-2">
            </p-button>
            <p-button 
                icon="pi pi-chevron-right" 
                [text]="true" 
                [rounded]="true"
                (onClick)="nextImage()"
                class="p-2">
            </p-button>
        </div>
        
        <!-- Botón de compartir por WhatsApp -->
        <p-button 
            icon="pi pi-whatsapp" 
            [text]="true" 
            [rounded]="true"
            (onClick)="shareProductOnWhatsapp()"
            class="share-btn-whatsapp text-2xl">
        </p-button>
        
        <!-- Galería de miniaturas que aparece al hacer hover -->
        <div class="thumbnail-gallery grid grid-cols-5 gap-2 group-hover:flex">
            @for (image of product.imagen; track $index) {
                <div class="thumbnail-container rounded-lg cursor-pointer"
                     (click)="selectImage($index)">
                    <div class="thumbnail" [class.active]="isActiveThumbnail($index)">
                        <img [src]="image.url" [alt]="image.alt">
                    </div>
                </div>
            }
        </div>
    </div>

    <!-- Contenido del producto -->
    <div class="flex-grow flex flex-col p-4 md:p-6 text-gray-800">
        <h3 class="text-lg md:text-xl font-semibold mb-2 line-clamp-2">{{ product.name }}</h3>
        <p class="text-sm text-gray-500 mb-2">Por {{ product.idBusiness}}</p>
        
        <div class="flex items-center justify-between mb-4 text-sm text-gray-600">
            <span class="font-medium">Categoría: {{ product.idCategoria }}</span>
            <span class="font-medium text-green-600">Cantidad disponible: {{ product.cantidad }}</span>
        </div>

        <!-- Precios y descuento -->
        <div class="mt-auto">
            <div class="flex items-end mb-4">
                @if(product.descuento != undefined && product.descuento > 0) {
                    <span class="old-price text-sm mr-2">{{product.precios[0].precio | currency:product.precios[0].codigo_iso :'code'}}</span>
                }
                <span class="text-2xl font-bold text-gray-900">{{ discount | currency:product.precios[0].codigo_iso :'code'}}</span>
            </div>
            
            <!-- Botones de acción y cuotas -->
            <div class="flex flex-col md:flex-row md:justify-between items-start md:items-center space-y-2 md:space-y-0">
                @if(product.descuento != undefined && product.descuento > 0) {
                <span class="discount-badge text-xs font-semibold px-2 py-1 rounded-full">{{ product.descuento }}% OFF</span>
                }
            </div>
            
            <!-- Contenedor de botones de acción -->
            <div class="flex flex-col md:flex-row md:space-x-4 space-y-4 md:space-y-0 mt-6">
                <!-- Botón inicial de Agregar al carrito -->
              <lib-button-add-to-card1 [product]="product"></lib-button-add-to-card1>

                <p-button 
                    label="Compartir   "
                    icon="pi pi-share-alt"
                    (onClick)="shareProduct()"
                    class="flex-1 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:bg-blue-700 transition-colors transform hover:scale-105">
                </p-button>
            </div>
        </div>
    </div>
}
@else {
    <div class="p-4 bg-yellow-100 text-yellow-800 rounded-lg">
        <p class="text-center">Producto no disponible</p>
    </div>
}
</div>